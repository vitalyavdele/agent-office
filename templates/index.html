<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agent Office HQ</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --bg:    #0f0f17;
  --bg2:   #13131e;
  --card:  rgba(255,255,255,.04);
  --bdr:   rgba(255,255,255,.08);
  --text:  #e2e8f0;
  --dim:   #64748b;
}

html, body { height: 100%; overflow: hidden; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Inter', system-ui, sans-serif;
  display: flex;
  flex-direction: column;
}

body::before {
  content: '';
  position: fixed; inset: 0;
  background:
    radial-gradient(ellipse at 10% 20%, rgba(124,58,237,.07) 0%, transparent 55%),
    radial-gradient(ellipse at 90% 80%, rgba(56,189,248,.05) 0%, transparent 55%);
  pointer-events: none;
}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
header {
  height: 54px;
  background: rgba(15,15,23,.95);
  backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--bdr);
  display: flex; align-items: center;
  padding: 0 24px;
  justify-content: space-between;
  flex-shrink: 0;
  position: relative; z-index: 10;
}

.logo {
  font-size: 15px; font-weight: 700;
  background: linear-gradient(135deg, #a78bfa, #38bdf8);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}

.hdr-right { display: flex; align-items: center; gap: 20px; }

.live {
  font-size: 12px; font-weight: 600; color: #4ade80;
  display: flex; align-items: center; gap: 7px;
}
.live::before {
  content: ''; width: 8px; height: 8px; border-radius: 50%;
  background: #4ade80;
  animation: livepulse 2s infinite;
}
.live.off { color: #fb7185; }
.live.off::before { background: #fb7185; animation: none; }

@keyframes livepulse {
  0%   { box-shadow: 0 0 0 0 rgba(74,222,128,.5); }
  70%  { box-shadow: 0 0 0 8px rgba(74,222,128,0); }
  100% { box-shadow: 0 0 0 0 rgba(74,222,128,0); }
}

.clock { font-size: 13px; font-weight: 500; color: var(--dim); font-variant-numeric: tabular-nums; }

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.main { flex: 1; display: flex; overflow: hidden; position: relative; z-index: 1; }

/* ‚îÄ‚îÄ WORKSPACE (left) ‚îÄ‚îÄ */
.workspace {
  width: 380px; flex-shrink: 0;
  border-right: 1px solid var(--bdr);
  padding: 18px 14px;
  overflow-y: auto;
  display: flex; flex-direction: column; gap: 10px;
}

.section-label {
  font-size: 9px; font-weight: 700; color: var(--dim);
  text-transform: uppercase; letter-spacing: 1.5px;
  padding: 0 2px;
}

/* Manager card */
.card-manager {
  background: var(--card);
  border: 1px solid rgba(167,139,250,.18);
  border-radius: 14px;
  padding: 14px 16px;
  display: flex; align-items: center; gap: 14px;
  transition: border-color .4s, box-shadow .4s;
}
.card-manager.thinking { border-color: rgba(167,139,250,.45); box-shadow: 0 0 20px rgba(167,139,250,.08); }
.card-manager.working  { border-color: rgba(167,139,250,.45); box-shadow: 0 0 20px rgba(167,139,250,.08); }

/* Worker grid */
.workers-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
}

.card-worker {
  background: var(--card);
  border: 1px solid var(--bdr);
  border-radius: 14px;
  padding: 14px;
  transition: border-color .4s, box-shadow .4s;
}
.card-worker.working { border-color: rgba(255,255,255,.14); }
.card-worker.done    { border-color: rgba(74,222,128,.3); }

/* Avatar */
.avatar {
  width: 42px; height: 42px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 19px; flex-shrink: 0;
}
.avatar-sm {
  width: 34px; height: 34px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 15px; flex-shrink: 0;
}

/* Status badge */
.badge {
  font-size: 9px; font-weight: 700; padding: 2px 8px;
  border-radius: 99px; text-transform: uppercase; letter-spacing: .5px;
  white-space: nowrap;
}
.badge.idle      { background: rgba(100,116,139,.15); color: var(--dim); }
.badge.thinking  { background: rgba(167,139,250,.18); color: #a78bfa; animation: blink .8s infinite; }
.badge.working   { background: rgba(74,222,128,.14);  color: #4ade80; }
.badge.done      { background: rgba(74,222,128,.2);   color: #4ade80; }

@keyframes blink { 0%,100%{opacity:1} 50%{opacity:.35} }

.card-info { flex: 1; min-width: 0; }
.card-name { font-size: 13px; font-weight: 600; color: #fff; }
.card-role { font-size: 10px; color: var(--dim); margin-top: 1px; }
.card-task {
  font-size: 11px; color: var(--dim); margin-top: 6px;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  transition: color .3s;
}
.card-task.active { color: var(--text); }

/* Activity bar */
.act-bar { height: 2px; background: rgba(255,255,255,.06); border-radius: 1px; margin-top: 10px; overflow: hidden; }
.act-fill { height: 100%; border-radius: 1px; transition: width .7s ease, background .4s; }
.act-fill.idle     { width: 0%; background: transparent; }
.act-fill.thinking { background: #a78bfa; animation: indeterminate 1.4s infinite; }
.act-fill.working  { background: #4ade80; }
.act-fill.done     { background: #4ade80; width: 100% !important; }

@keyframes indeterminate {
  0%   { transform: translateX(-100%); width: 55%; }
  100% { transform: translateX(220%);  width: 55%; }
}

/* ‚îÄ‚îÄ CHAT PANEL (right) ‚îÄ‚îÄ */
.chat-panel {
  flex: 1;
  display: flex; flex-direction: column;
  overflow: hidden;
}

.messages {
  flex: 1; overflow-y: auto;
  padding: 20px 24px;
  display: flex; flex-direction: column; gap: 18px;
}

/* empty state */
.empty {
  flex: 1; display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  gap: 10px; opacity: .35; pointer-events: none;
  text-align: center;
}
.empty-icon { font-size: 44px; }
.empty-title { font-size: 15px; font-weight: 600; }
.empty-sub   { font-size: 12px; color: var(--dim); }

/* Message rows */
.msg { display: flex; gap: 11px; max-width: 88%; animation: msgin .2s ease; }
@keyframes msgin {
  from { opacity: 0; transform: translateY(5px); }
  to   { opacity: 1; transform: translateY(0); }
}
.msg.user   { align-self: flex-end; flex-direction: row-reverse; }
.msg.system { align-self: center; max-width: 100%; }

.msg-av {
  width: 30px; height: 30px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 13px; flex-shrink: 0; margin-top: 3px;
}

.msg-body { display: flex; flex-direction: column; gap: 4px; }
.msg-meta { display: flex; align-items: baseline; gap: 8px; }
.msg.user .msg-meta { flex-direction: row-reverse; }
.msg-name { font-size: 11px; font-weight: 700; }
.msg-time { font-size: 10px; color: var(--dim); font-variant-numeric: tabular-nums; }

.msg-bubble {
  padding: 10px 14px; border-radius: 12px;
  font-size: 13px; line-height: 1.65;
  white-space: pre-wrap; word-break: break-word;
}
.msg.user .msg-bubble {
  background: linear-gradient(135deg, #4f46e5, #7c3aed);
  color: #fff;
  border-radius: 12px 12px 4px 12px;
}
.msg.agent .msg-bubble {
  background: rgba(255,255,255,.04);
  border: 1px solid var(--bdr);
  border-radius: 4px 12px 12px 12px;
}
.msg.system .msg-bubble {
  background: rgba(255,255,255,.03);
  border: 1px solid var(--bdr);
  border-radius: 8px;
  font-size: 11px; color: var(--dim); text-align: center;
}
.msg-bubble strong { font-weight: 700; color: #fff; }
.msg-bubble code {
  background: rgba(255,255,255,.1);
  padding: 1px 5px; border-radius: 3px;
  font-family: 'Fira Code', 'Courier New', monospace;
  font-size: 12px;
}
.msg-bubble pre {
  background: rgba(0,0,0,.4);
  border: 1px solid var(--bdr);
  border-radius: 8px;
  padding: 12px;
  margin-top: 8px;
  overflow-x: auto;
}
.msg-bubble pre code { background: none; padding: 0; font-size: 12px; }

/* ‚îÄ‚îÄ INPUT ‚îÄ‚îÄ */
.input-area {
  border-top: 1px solid var(--bdr);
  padding: 14px 20px 16px;
  background: rgba(15,15,23,.7);
  backdrop-filter: blur(8px);
}
.input-row { display: flex; gap: 10px; align-items: flex-end; }

.input-box {
  flex: 1;
  background: rgba(255,255,255,.05);
  border: 1px solid var(--bdr);
  border-radius: 12px;
  padding: 10px 14px;
  color: var(--text);
  font-family: inherit; font-size: 14px;
  resize: none; min-height: 44px; max-height: 120px; line-height: 1.5;
  transition: border-color .2s; outline: none;
}
.input-box:focus { border-color: rgba(167,139,250,.4); }
.input-box::placeholder { color: var(--dim); }
.input-box:disabled { opacity: .5; cursor: not-allowed; }

.send-btn {
  width: 44px; height: 44px; border-radius: 12px;
  background: #4f46e5; border: none; cursor: pointer; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  font-size: 17px; color: #fff;
  transition: background .2s, transform .1s;
}
.send-btn:hover:not(:disabled) { background: #4338ca; }
.send-btn:active:not(:disabled) { transform: scale(.93); }
.send-btn:disabled { opacity: .4; cursor: not-allowed; }

.input-hint { font-size: 10px; color: var(--dim); margin-top: 6px; }

/* scrollbar */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(255,255,255,.08); border-radius: 2px; }
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="logo">üè¢ Agent Office HQ</div>
  <div class="hdr-right">
    <div class="live" id="liveEl">LIVE</div>
    <div class="clock" id="clockEl">00:00:00</div>
  </div>
</header>

<div class="main">

  <!-- ‚îÄ‚îÄ WORKSPACE ‚îÄ‚îÄ -->
  <aside class="workspace">
    <div class="section-label">–†–∞–±–æ—á–µ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ</div>

    <!-- Manager card (full-width) -->
    <div class="card-manager idle" id="card-manager">
      <div class="avatar" style="background:rgba(167,139,250,.15)">üéØ</div>
      <div class="card-info">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:3px;">
          <span class="card-name">Manager</span>
          <span class="badge idle" id="badge-manager">IDLE</span>
        </div>
        <div class="card-role">Orchestrator</div>
        <div class="card-task" id="task-manager">–û–∂–∏–¥–∞–µ—Ç –∑–∞–¥–∞—á—É</div>
        <div class="act-bar"><div class="act-fill idle" id="fill-manager" style="width:0%"></div></div>
      </div>
    </div>

    <div class="section-label" style="margin-top:4px">–ö–æ–º–∞–Ω–¥–∞</div>
    <div class="workers-grid" id="workersGrid">
      <!-- filled by JS -->
    </div>
  </aside>

  <!-- ‚îÄ‚îÄ CHAT ‚îÄ‚îÄ -->
  <section class="chat-panel">
    <div class="messages" id="messages">
      <div class="empty" id="emptyState">
        <div class="empty-icon">üí¨</div>
        <div class="empty-title">–í–≤–µ–¥–∏—Ç–µ –∑–∞–¥–∞—á—É –¥–ª—è –∫–æ–º–∞–Ω–¥—ã</div>
        <div class="empty-sub">–ú–µ–Ω–µ–¥–∂–µ—Ä —Ä–∞–∑–±–µ—Ä—ë—Ç –µ—ë –∏ –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –Ω—É–∂–Ω—ã–º –∞–≥–µ–Ω—Ç–∞–º</div>
      </div>
    </div>

    <div class="input-area">
      <div class="input-row">
        <textarea
          id="taskInput"
          class="input-box"
          placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –Ω–∞–ø–∏—à–∏ —Å—Ç–∞—Ç—å—é –ø—Ä–æ React hooks, –∏–ª–∏ –Ω–∞–π–¥–∏ —Ç—Ä–µ–Ω–¥—ã –≤ AI –∑–∞ 2025 –≥–æ–¥‚Ä¶"
          rows="1"
        ></textarea>
        <button class="send-btn" id="sendBtn" title="Ctrl+Enter">‚û§</button>
      </div>
      <div class="input-hint">Ctrl+Enter ¬∑ –º–µ–Ω–µ–¥–∂–µ—Ä —Å–∞–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç —Ä–∞–±–æ—Ç—É</div>
    </div>
  </section>

</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   WORKER CARDS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const WORKERS = [
  { key:'researcher', name:'Researcher', emoji:'üîç', color:'#38bdf8', bg:'rgba(56,189,248,.12)',  role:'Web Researcher'  },
  { key:'writer',     name:'Writer',     emoji:'‚úçÔ∏è', color:'#4ade80', bg:'rgba(74,222,128,.12)',  role:'Content Writer'  },
  { key:'coder',      name:'Coder',      emoji:'üíª', color:'#facc15', bg:'rgba(250,204,21,.12)',  role:'Code Engineer'   },
  { key:'analyst',    name:'Analyst',    emoji:'üìä', color:'#fb7185', bg:'rgba(251,113,133,.12)', role:'Data Analyst'    },
];

document.getElementById('workersGrid').innerHTML = WORKERS.map(w => `
  <div class="card-worker idle" id="card-${w.key}">
    <div style="display:flex;align-items:center;gap:9px;margin-bottom:8px;">
      <div class="avatar-sm" style="background:${w.bg}">${w.emoji}</div>
      <div style="flex:1;min-width:0;">
        <div class="card-name" style="font-size:12px;">${w.name}</div>
        <div class="card-role">${w.role}</div>
      </div>
      <span class="badge idle" id="badge-${w.key}">IDLE</span>
    </div>
    <div class="card-task" id="task-${w.key}">–°–≤–æ–±–æ–¥–µ–Ω</div>
    <div class="act-bar"><div class="act-fill idle" id="fill-${w.key}" style="width:0%"></div></div>
  </div>
`).join('');

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   UPDATE AGENT CARD
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const BADGE_LABELS = { idle:'IDLE', thinking:'–î–£–ú–ê–ï–¢', working:'–ê–ö–¢–ò–í–ï–ù', done:'–ì–û–¢–û–í–û' };

function updateCard(a) {
  const isManager = a.key === 'manager';
  const card  = document.getElementById(`card-${a.key}`);
  const badge = document.getElementById(`badge-${a.key}`);
  const task  = document.getElementById(`task-${a.key}`);
  const fill  = document.getElementById(`fill-${a.key}`);
  if (!card) return;

  card.className  = `card-${isManager ? 'manager' : 'worker'} ${a.status}`;
  badge.className = `badge ${a.status}`;
  badge.textContent = BADGE_LABELS[a.status] || a.status.toUpperCase();
  task.textContent  = a.task;
  task.className    = `card-task${a.status !== 'idle' ? ' active' : ''}`;
  fill.className    = `act-fill ${a.status}`;

  if (a.status === 'working' || a.status === 'done') {
    fill.style.width = a.progress + '%';
  } else if (a.status === 'idle') {
    fill.style.width = '0%';
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CHAT RENDERING
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const AGENT_COLORS = {
  manager:'#a78bfa', researcher:'#38bdf8', writer:'#4ade80',
  coder:'#facc15',   analyst:'#fb7185',    user:'#818cf8', system:'#64748b',
};
const AGENT_EMOJIS = {
  manager:'üéØ', researcher:'üîç', writer:'‚úçÔ∏è',
  coder:'üíª',   analyst:'üìä',    user:'üë§',    system:'‚öôÔ∏è',
};

function md(text) {
  // Basic markdown: bold, inline code, fenced code blocks
  return text
    .replace(/```(\w*)\n?([\s\S]*?)```/g, (_, lang, code) =>
      `<pre><code>${escHtml(code.trim())}</code></pre>`)
    .replace(/`([^`]+)`/g, (_, c) => `<code>${escHtml(c)}</code>`)
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/\n/g, '<br>');
}
function escHtml(s) {
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function addMessage(msg) {
  const empty = document.getElementById('emptyState');
  if (empty) empty.remove();

  const wrap = document.getElementById('messages');
  const isUser   = msg.role === 'user';
  const isSystem = msg.role === 'system';
  const color = msg.color || AGENT_COLORS[msg.role] || '#888';
  const emoji = msg.emoji || AGENT_EMOJIS[msg.role] || 'ü§ñ';

  const div = document.createElement('div');
  div.className = `msg ${isUser ? 'user' : isSystem ? 'system' : 'agent'}`;

  if (isSystem) {
    div.innerHTML = `<div class="msg-bubble">${escHtml(msg.content)}</div>`;
  } else {
    div.innerHTML = `
      <div class="msg-av" style="background:${color}22">${emoji}</div>
      <div class="msg-body">
        <div class="msg-meta">
          <span class="msg-name" style="color:${color}">${escHtml(msg.name)}</span>
          <span class="msg-time">${msg.time}</span>
        </div>
        <div class="msg-bubble">${md(msg.content)}</div>
      </div>`;
  }

  wrap.appendChild(div);
  wrap.scrollTop = wrap.scrollHeight;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   WEBSOCKET
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let ws, busy = false;

function setBusy(state) {
  busy = state;
}

function connect() {
  ws = new WebSocket(`${location.protocol === 'https:' ? 'wss' : 'ws'}://${location.host}/ws`);
  const liveEl = document.getElementById('liveEl');

  ws.onopen = () => {
    liveEl.textContent = 'LIVE';
    liveEl.className = 'live';
  };

  ws.onclose = () => {
    liveEl.textContent = 'OFFLINE';
    liveEl.className = 'live off';
    setTimeout(connect, 3000);
  };

  ws.onmessage = e => {
    const data = JSON.parse(e.data);

    if (data.type === 'init') {
      data.agents.forEach(updateCard);
      data.history.forEach(addMessage);
      const anyBusy = data.agents.some(a => a.status !== 'idle');
      setBusy(anyBusy);
    }
    else if (data.type === 'agents') {
      data.agents.forEach(updateCard);
      const anyBusy = data.agents.some(a => a.status !== 'idle');
      setBusy(anyBusy);
    }
    else if (data.type === 'chat') {
      addMessage(data.message);
    }
  };
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SEND
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function sendTask() {
  const input = document.getElementById('taskInput');
  const text  = input.value.trim();
  if (!text || busy || !ws || ws.readyState !== 1) return;
  ws.send(JSON.stringify({ type: 'task', content: text }));
  input.value = '';
  input.style.height = 'auto';
  setBusy(true);
}

document.getElementById('sendBtn').addEventListener('click', sendTask);

document.getElementById('taskInput').addEventListener('keydown', e => {
  if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
    e.preventDefault();
    sendTask();
  }
  setTimeout(() => {
    const el = document.getElementById('taskInput');
    el.style.height = 'auto';
    el.style.height = Math.min(el.scrollHeight, 120) + 'px';
  });
});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CLOCK
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
(function tick() {
  const n = new Date();
  document.getElementById('clockEl').textContent =
    [n.getHours(), n.getMinutes(), n.getSeconds()]
      .map(v => String(v).padStart(2, '0')).join(':');
  setTimeout(tick, 1000);
})();

connect();
</script>
</body>
</html>
